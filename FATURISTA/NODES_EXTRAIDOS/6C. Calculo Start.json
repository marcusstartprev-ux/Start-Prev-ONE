{
  "parameters": {
    "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// NÃ“ 6C - CÃLCULO START (v3.2 - VALOR REAL DO EXTRATO)\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// VersÃ£o: 3.2 - HonorÃ¡rios calculados sobre valor REAL do extrato + projetadas\n// Data: 19/01/2026\n// Autor: Start Assessoria PrevidenciÃ¡ria\n//\n// CORREÃ‡ÃƒO v3.2:\n// âœ… Parcelas do EXTRATO: base usa valor_liquido REAL do PDF (liquido do crÃ©dito)\n// âœ… Parcelas PROJETADAS: base usa valor projetado do 6B (valor_liquido)\n// âœ… honorariosStart = totalHonorariosBase Ã— 30%\n// âœ… MantÃ©m output/estrutura para nÃ£o quebrar nÃ³s posteriores\n//\n// REGRA DA DARF (mantida):\n// âœ… DARF Ã© um ADIANTAMENTO que a Start faz pelo cliente\n// âœ… Cliente precisa DEVOLVER esse valor para a Start\n// âœ… DARF Ã© SOMADA ao valor_start (aumenta o que Start recebe)\n// âœ… DARF Ã© SUBTRAÃDA do valor_cliente (diminui o que cliente fica)\n// âœ… DARF NÃƒO afeta a regra dos 50% (calculada ANTES)\n// âœ… DARF Ã© rateada apenas nas parcelas onde Start recebe (valor_start > 0)\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst inicio = Date.now();\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// CONFIGURAÃ‡Ã•ES\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst CONFIG = {\n  ALIQUOTA_HONORARIOS: 0.30,\n  FAIXAS: [\n    { min: 2000, aliquota: 0.45, nome: 'FAIXA_45' },\n    { min: 1500, aliquota: 0.40, nome: 'FAIXA_40' },\n    { min: 700,  aliquota: 0.35, nome: 'FAIXA_35' },\n    { min: 0,    aliquota: 0.30, nome: 'FAIXA_30' }\n  ],\n  MINIMO_CLIENTE: 0.50,\n  PARCELA_BAIXA_LIMITE: 100,\n  MUITAS_PARCELAS_LIMITE: 5,\n  MARGEM_APERTADA_LIMITE: 0.55\n};\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// MAPEAMENTO DE CAMPOS DO DEAL (IDs Bitrix) - v3.2\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst CD = {\n  // â•â•â• 1. IDENTIFICAÃ‡ÃƒO â•â•â•\n  cpf:                      'UF_CRM_5F7DD07B0ADB5',\n  rg:                       'UF_CRM_5F7DD07B11C33',\n  nit:                      'UF_CRM_1766282969',\n  nb:                       'UF_CRM_1737470444334',\n  nome_filho:               'UF_CRM_1699462600794',\n  categoria:                'UF_CRM_5F7DD07B0295D',\n\n  // â•â•â• 2. BENEFÃCIO (Datas) â•â•â•\n  dib:                      'UF_CRM_1765928945',\n  dip:                      'UF_CRM_1766439387',\n  dcb:                      'UF_CRM_1748433331869',\n  dn_mamae:                 'UF_CRM_1602615428011',\n  dn_filho:                 'UF_CRM_5F7DD07B1997D',\n  dn_certidao:              'UF_CRM_1714741602233',\n  data_dnv:                 'UF_CRM_1742827283535',\n  data_requerimento:        'UF_CRM_6094054C7C1C8',\n  data_concessao:           'UF_CRM_1602256897805',\n\n  // â•â•â• 3. BENEFÃCIO (Valores) â•â•â•\n  mr_cliente:               'UF_CRM_1741726157749',\n  valor_total_beneficio:    'UF_CRM_1742841962002',\n  aliquota_mr:              'UF_CRM_1742841855608',\n\n  // â•â•â• 5. FATURAMENTO (Parcela) â•â•â•\n  valor_inss:               'UF_CRM_1634158430224',\n  valor_cliente:            'UF_CRM_1634828809106',\n  valor_previsto:           'UF_CRM_1635261498013',\n  valor_recebido:           'UF_CRM_1633535814529',\n  parcela_numero:           'UF_CRM_1634158972573',\n  qtd_parcelas:             'UF_CRM_1625253358741',\n\n  // â•â•â• 8. BANCO â•â•â•\n  banco:                    'UF_CRM_1603216440272',\n  endereco_banco:           'UF_CRM_1603216499370',\n  agencia_banco:            'UF_CRM_1762558313',\n\n  // â•â•â• 9. CONTROLE / ANÃLISE â•â•â•\n  justificativa_direito:    'UF_CRM_1765636941',\n  data_rodagem:             'UF_CRM_1764270308863',\n  rodagem_comentario:       'UF_CRM_1764270260617',\n\n  // â•â•â• 10. GESTÃƒO â•â•â•\n  assessor:                 'UF_CRM_5F7DD07AEC035',\n  ultimo_relacionador:      'UF_CRM_1688072257656',\n  ddd_cliente:              'UF_CRM_659C48C5F0594',\n  data_reclamacao:          'UF_CRM_1704738513559',\n  data_qualificacao:        'UF_CRM_65E74D984ED3C',\n  data_recuperacao:         'UF_CRM_1713804709729',\n  data_encerramento:        'UF_CRM_663007E42D75E',\n  data_reentrada:           'UF_CRM_1615653096667',\n\n  // â•â•â• DARF / GUIA â•â•â•\n  necessita_darf:           'UF_CRM_1650375670632',\n  valor_darf:               'UF_CRM_69416D0451D4A'\n};\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// MAPEAMENTO DE CAMPOS DA INVOICE (IDs Bitrix) - v3.2\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst CI = {\n  // â•â•â• 1. IDENTIFICAÃ‡ÃƒO â•â•â•\n  cpf:                      'UF_CRM_652439CFE551C',\n  rg:                       'UF_CRM_652439D00A9CF',\n  nit:                      'UF_CRM_6947602572F0A',\n  nb:                       'UF_CRM_6790DAD756E3C',\n  nome_filho:               'UF_CRM_65BD5488EC8E9',\n  categoria:                'UF_CRM_652439D03479D',\n\n  // â•â•â• 2. BENEFÃCIO (Datas) â•â•â•\n  dib:                      'UF_CRM_69442F085B2CD',\n  dip:                      'UF_CRM_683860072DEB8',\n  dcb:                      'UF_CRM_6838600845561',\n  dn_mamae:                 'UF_CRM_652439D0138A5',\n  dn_filho:                 'UF_CRM_652439D021438',\n  dn_certidao:              'UF_CRM_66351141F40C7',\n  data_dnv:                 'UF_CRM_67E17F1C70EAF',\n  data_requerimento:        'UF_CRM_652439D3530AB',\n  data_concessao:           'UF_CRM_652439D157BA8',\n\n  // â•â•â• 3. BENEFÃCIO (Valores) â•â•â•\n  mr_cliente:               'UF_CRM_67D19072D84A8',\n  valor_diario:             'UF_CRM_69442F466791E',\n  valor_liquido_mensal:     'UF_CRM_69442F4D0909D',\n  valor_total_beneficio:    'UF_CRM_69442F535C91B',\n  valor_restante_inss:      'UF_CRM_69442F3A581C2',\n  aliquota_mr:              'UF_CRM_67E1B184633ED',\n  especie_beneficio:        'UF_CRM_69442F6570BDB',\n\n  // â•â•â• 4. HONORÃRIOS START â•â•â•\n  valor_total_start:        'UF_CRM_69442F217FB9D',\n  saldo_restante_start:     'UF_CRM_69442F27CCFB3',\n  aliquota_start:           'UF_CRM_69442F596A782',\n  regra_aplicada:           'UF_CRM_69442F5F762AD',\n\n  // â•â•â• 5. FATURAMENTO (Parcela) â•â•â•\n  valor_inss:               'UF_CRM_652439D8D6B8E',\n  valor_cliente:            'UF_CRM_652439D915311',\n  valor_previsto:           'UF_CRM_652439D9202B3',\n  parcela_numero:           'UF_CRM_652439D8E9608',\n  parcela_formato:          'UF_CRM_652439D8CDB53',\n  qtd_parcelas:             'UF_CRM_67E1AD2860054',\n\n  // â•â•â• 6. EXTRATO / COMPETÃŠNCIA â•â•â•\n  competencia:              'UF_CRM_691B6450B46E3',\n  competencia_final:        'UF_CRM_69442F0E9A95A',\n  periodo:                  'UF_CRM_691B64560A17F',\n  ultima_comp_valida:       'UF_CRM_693D7DE5148DB',\n  credito_invalidado:       'UF_CRM_691B6467F11F2',\n  dias_ja_recebidos:        'UF_CRM_69442F2E321C4',\n  dias_restantes:           'UF_CRM_69442F3449D22',\n\n  // â•â•â• 7. DATAS OPERACIONAIS â•â•â•\n  data_inss:                'UF_CRM_652439D8B3207',\n  data_pagamento_extrato:   'UF_CRM_691B64616C2C9',\n  data_atualizacao_extrato: 'UF_CRM_691B646EC01BF',\n\n  // â•â•â• 8. BANCO â•â•â•\n  banco:                    'UF_CRM_652439D194A06',\n  endereco_banco:           'UF_CRM_652439D1A53FA',\n  agencia_banco:            'UF_CRM_691225FDDDBE4',\n\n  // â•â•â• 9. CONTROLE / ANÃLISE â•â•â•\n  justificativa_direito:    'UF_CRM_693D7BBC3E5D3',\n  resultado_analise:        'UF_CRM_693D7CB58EBD2',\n  data_rodagem:             'UF_CRM_6929FDA3C8A79',\n  rodagem_comentario:       'UF_CRM_6929FD9E9A95D',\n  direito_ate:              'UF_CRM_679781AAB3B1D',\n\n  // â•â•â• 10. GESTÃƒO â•â•â•\n  ultimo_relacionador:      'UF_CRM_65BD5488EC8E9',\n  ddd_cliente:              'UF_CRM_65BD5489DF3A2',\n  data_reclamacao:          'UF_CRM_65BD5489C89AD',\n  data_qualificacao:        'UF_CRM_65E777E2A0CED',\n  data_recuperacao:         'UF_CRM_662699414BCF0',\n  data_encerramento:        'UF_CRM_6631460FD3BB4',\n  data_reentrada:           'UF_CRM_678EADB02E460',\n\n  // â•â•â• DARF / GUIA â•â•â•\n  necessita_darf:           'UF_CRM_652439D99106D',\n  valor_darf:               'UF_CRM_695C0F05B6DD0'\n};\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// CAMPOS EXTRAS - Mapeados para uso futuro\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst CAMPOS_EXTRAS = {\n  // Deal\n  data_encerramento_sem_direito_deal: 'UF_CRM_663007E518A1E',\n  data_conversao_deal:                'UF_CRM_5F7DD07B204FD',\n  data_certidao_deal:                 'UF_CRM_1674755625727',\n  data_consulta_deal:                 'UF_CRM_1602256877083',\n  data_contato_deal:                  'UF_CRM_1650915373840',\n  data_prox_contato_deal:             'UF_CRM_1650915411107',\n  data_sem_direito_deal:              'UF_CRM_1649701660322',\n  data_indeferimento_deal:            'UF_CRM_1620315580',\n  data_quebra_contrato_deal:          'UF_CRM_1737722079155',\n  relacionador_quebra_deal:           'UF_CRM_1737722166447',\n  relacionador_sem_direito_deal:      'UF_CRM_1737722233583',\n  recurso_deal:                       'UF_CRM_1759219838803',\n  senha_deal:                         'UF_CRM_1602257200479',\n  sugestao_senha_deal:                'UF_CRM_5FDA4FCE92DAA',\n  telefone_2_deal:                    'UF_CRM_606C6C98B68A7',\n  telefone_3_deal:                    'UF_CRM_606C6C9A00D10',\n  sine_deal:                          'UF_CRM_1751375841241',\n  data_envio_recurso_deal:            'UF_CRM_1759220050331',\n\n  // Invoice\n  resultado_criacao_faturas_inv:      'UF_CRM_SMART_INVOICE_1767045330',\n  data_conversao_inv:                 'UF_CRM_652439D0CF19F',\n  data_calculo_inv:                   'UF_CRM_69442F14E544C',\n  data_certidao_inv:                  'UF_CRM_652439DA75EFF',\n  data_consulta_inv:                  'UF_CRM_652439D14CF3D',\n  data_acordo_inv:                    'UF_CRM_652439DB85203',\n  data_contato_inv:                   'UF_CRM_652439D9B26DF',\n  data_sem_direito_inv:               'UF_CRM_66ACE094C0195',\n  data_pagamento_inv:                 'UF_CRM_652439D8BD582',\n  data_indeferimento_inv:             'UF_CRM_652439D3E866C',\n  data_recebimento_inv:               'UF_CRM_652439D1B26E2',\n  desconto_inv:                       'UF_CRM_6838600A5C767',\n  data_quebra_contrato_inv:           'UF_CRM_6793A405B3FC1',\n  relacionador_quebra_inv:            'UF_CRM_6793A4065BECA',\n  relacionador_sem_direito_inv:       'UF_CRM_6793A40701BCB',\n  recurso_inv:                        'UF_CRM_68DD552A351D0',\n  senha_inv:                          'UF_CRM_652439D16254A',\n  sugestao_senha_inv:                 'UF_CRM_652439D23E905',\n  telefone_2_inv:                     'UF_CRM_652439D28D353',\n  telefone_3_inv:                     'UF_CRM_652439D298A88',\n  sine_inv:                           'UF_CRM_6883D4B47136F',\n  data_envio_recurso_inv:             'UF_CRM_68DD552F3DD02'\n};\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// SISTEMA DE ERROS\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst ERROS = {\n  E_INPUT_NULO: { codigo: 'E01', mensagem: 'Input do 6B veio nulo/undefined', severidade: 'CRITICO', acao: 'Verificar conexÃ£o entre nÃ³s 6B â†’ 6C' },\n  E_INPUT_OK_FALSE: { codigo: 'E02', mensagem: '6B retornou ok=false', severidade: 'CRITICO', acao: 'Verificar erro reportado pelo 6B' },\n  E_SEM_RESUMO: { codigo: 'E03', mensagem: 'Campo resumo ausente no input', severidade: 'CRITICO', acao: 'Verificar estrutura de retorno do 6B' },\n  E_SEM_DADOS: { codigo: 'E04', mensagem: 'Campo dados ausente no input', severidade: 'CRITICO', acao: 'Verificar estrutura de retorno do 6B' },\n  E_SEM_DEAL: { codigo: 'E05', mensagem: 'Deal nÃ£o veio do 6B', severidade: 'CRITICO', acao: 'Verificar se 6A/6B estÃ£o passando deal adiante' },\n\n  E_SEM_CREDITOS: { codigo: 'E06', mensagem: 'Nenhum crÃ©dito no extrato', severidade: 'ALERTA', acao: 'Verificar se extrato foi processado corretamente' },\n  E_SEM_PARCELAS: { codigo: 'E07', mensagem: 'Nenhuma parcela (extrato + projetadas)', severidade: 'CRITICO', acao: 'Verificar se hÃ¡ crÃ©ditos ou projeÃ§Ãµes disponÃ­veis' },\n\n  E_TOTAL_120_ZERO: { codigo: 'E08', mensagem: 'Total 120 dias = 0', severidade: 'CRITICO', acao: 'Verificar cÃ¡lculo de valor diÃ¡rio no 6B' },\n  E_TOTAL_120_NEGATIVO: { codigo: 'E09', mensagem: 'Total 120 dias < 0 (valor negativo)', severidade: 'CRITICO', acao: 'Verificar se MR e desconto INSS estÃ£o corretos' },\n  E_MR_ZERO: { codigo: 'E10', mensagem: 'MR (MÃ©dia RemuneraÃ§Ã£o) veio zerado', severidade: 'CRITICO', acao: 'Verificar extraÃ§Ã£o de MR do PDF pelo Gemini' },\n  E_ALIQUOTA_INSS_ZERO: { codigo: 'E11', mensagem: 'AlÃ­quota INSS nÃ£o veio do 6B', severidade: 'ALERTA', acao: 'Usando fallback 7.5% - verificar cÃ¡lculo no 6B' },\n  E_HONORARIOS_ZERO: { codigo: 'E12', mensagem: 'HonorÃ¡rios calculados = 0', severidade: 'CRITICO', acao: 'Verificar se base de honorÃ¡rios estÃ¡ correta (extrato + projeÃ§Ãµes)' },\n\n  E_PARCELA_SEM_DATA: { codigo: 'E13', mensagem: 'Parcela sem data de pagamento', severidade: 'CRITICO', acao: 'Verificar calendÃ¡rio INSS no 6B' },\n  E_PARCELA_SEM_VALOR: { codigo: 'E14', mensagem: 'Parcela com valor 0 ou nulo', severidade: 'CRITICO', acao: 'Verificar extraÃ§Ã£o de valores do extrato' },\n\n  E_CALCULO_EXCEPTION: { codigo: 'E15', mensagem: 'Exception durante cÃ¡lculo', severidade: 'CRITICO', acao: 'Verificar stack trace nos detalhes' },\n  E_REGRA_50_IMPOSSIVEL: { codigo: 'E16', mensagem: 'ImpossÃ­vel aplicar regra 50% em todas parcelas', severidade: 'ALERTA', acao: 'Verificar se hÃ¡ parcelas muito pequenas' }\n};\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// SISTEMA DE ALERTAS\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst ALERTAS = {\n  'ALERTA_ALIQUOTA_INSS_NAO_VEIO_6B': { emoji: 'âš ï¸', texto: 'AlÃ­quota INSS nÃ£o veio do 6B, usando 7.5%' },\n  'ALERTA_EXTRATO_SEM_CREDITOS': { emoji: 'ğŸ“‹', texto: 'Extrato sem crÃ©ditos, usando apenas projeÃ§Ãµes' },\n  'ALERTA_REPROCESSAMENTO': { emoji: 'ğŸ”„', texto: 'Reprocessamento detectado (saldo Start jÃ¡ existe)' },\n  'ALERTA_PARCELA_BAIXA': { emoji: 'ğŸ’°', texto: 'Parcela com valor baixo' },\n  'ALERTA_MARGEM_50_APERTADA': { emoji: 'âš–ï¸', texto: 'Margem 50% apertada' },\n  'ALERTA_DATA_RETROATIVA': { emoji: 'ğŸ“…', texto: 'Data de pagamento retroativa' },\n  'ALERTA_REGRA_50_VIOLADA': { emoji: 'âŒ', texto: 'Regra 50% violada em parcela' },\n  'ALERTA_REGRA_50_NAO_RESPEITADA_GERAL': { emoji: 'âš ï¸', texto: 'Regra 50% nÃ£o respeitada em alguma parcela' },\n  'ALERTA_MUITAS_PARCELAS': { emoji: 'ğŸ“Š', texto: 'Muitas parcelas no benefÃ­cio' },\n  'ALERTA_QUITACAO_TARDIA': { emoji: 'ğŸ', texto: 'QuitaÃ§Ã£o apenas na Ãºltima parcela' },\n  'ALERTA_SALDO_RESIDUAL': { emoji: 'ğŸ’¸', texto: 'Saldo residual pequeno (< R$ 1)' },\n  'ALERTA_DEAL_SEM_CAMPOS_START': { emoji: 'ğŸ“', texto: 'Deal sem campos Start preenchidos' },\n  'ALERTA_DIP_NAO_VEIO_6B': { emoji: 'ğŸ“†', texto: 'DIP nÃ£o veio do 6B' },\n\n  // DARF\n  'ALERTA_DARF_START_PAGA': { emoji: 'ğŸ§¾', texto: 'DARF adicionada aos honorÃ¡rios Start (cliente reembolsa)' },\n  'ALERTA_DARF_START_PAGA_SEM_VALOR': { emoji: 'âš ï¸', texto: 'Start irÃ¡ pagar a DARF marcado, mas Valor da DARF estÃ¡ vazio/zerado' },\n  'ALERTA_DARF_SEM_PARCELAS_START': { emoji: 'âš ï¸', texto: 'DARF marcada para Start pagar, mas nÃ£o hÃ¡ parcelas com recebimento Start' }\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// FUNÃ‡Ã•ES AUXILIARES\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst tr = (v) => Math.floor((v || 0) * 100) / 100;\nconst formatarMoeda = (v) => `R$ ${tr(v).toFixed(2).replace('.', ',')}`;\nconst formatarPercentual = (v) => `${(v * 100).toFixed(2)}%`;\n\nconst parseValor = (v) => {\n  if (v === null || v === undefined || v === '') return 0;\n  if (typeof v === 'number') return v;\n  if (typeof v === 'string') {\n    let limpo = v.replace('|BRL', '').replace(/[R$\\s]/g, '').trim();\n    const temVirgula = limpo.includes(',');\n    const temPonto = limpo.includes('.');\n    if (temVirgula && temPonto) {\n      limpo = limpo.replace(/\\./g, '').replace(',', '.');\n    } else if (temVirgula) {\n      limpo = limpo.replace(',', '.');\n    }\n    const n = parseFloat(limpo);\n    return isNaN(n) ? 0 : n;\n  }\n  return 0;\n};\n\nconst formatarDataBR = (data) => {\n  if (!data) return '-';\n  if (typeof data === 'string' && data.includes('/')) return data;\n  const d = new Date(data);\n  if (isNaN(d.getTime())) return '-';\n  return d.toLocaleDateString('pt-BR');\n};\n\nconst extrairData = (data) => {\n  if (!data) return null;\n  if (typeof data === 'string') {\n    if (/^\\d{4}-\\d{2}-\\d{2}/.test(data)) return data.substring(0, 10);\n    if (/^\\d{2}\\/\\d{2}\\/\\d{4}/.test(data)) {\n      const [d, m, y] = data.split('/');\n      return `${y}-${m}-${d}`;\n    }\n  }\n  const d = new Date(data);\n  if (isNaN(d.getTime())) return null;\n  return d.toISOString().substring(0, 10);\n};\n\nconst formatMoneyBitrix = (valor) => {\n  if (!valor && valor !== 0) return null;\n  return `${tr(valor)}|BRL`;\n};\n\nconst formatDateBitrix = (dataISO) => {\n  if (!dataISO) return null;\n  const data = extrairData(dataISO);\n  if (!data) return null;\n  return `${data}T03:00:00+00:00`;\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// FUNÃ‡Ã•ES DE RETORNO\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst criarErro = (tag, detalhes = {}, contexto = {}, campos_deal = {}, campos_invoice_base = {}) => {\n  const erro = ERROS[tag] || { codigo: 'E99', mensagem: 'Erro desconhecido', severidade: 'CRITICO', acao: 'Contatar suporte' };\n  return [{\n    json: {\n      _no: '6C',\n      _versao: '3.2',\n      _timestamp: new Date().toISOString(),\n      _tempo_ms: Date.now() - inicio,\n\n      ok: false,\n      erro: {\n        tag,\n        codigo: erro.codigo,\n        mensagem: erro.mensagem,\n        severidade: erro.severidade,\n        acao_sugerida: erro.acao,\n        detalhes\n      },\n\n      alertas: [],\n      tags_sucesso: [],\n      info: [],\n\n      resumo: {\n        nome: contexto.nome || 'Desconhecido',\n        cpf: contexto.cpf || '',\n        nb: contexto.nb || '',\n        deal_id: contexto.deal_id || null\n      },\n\n      dados: {\n        deal_id: contexto.deal_id,\n        deal: contexto.deal\n      },\n\n      CAMPOS_DEAL_IDS: CD,\n      CAMPOS_INVOICE_IDS: CI,\n      CAMPOS_EXTRAS: CAMPOS_EXTRAS,\n\n      campos_deal,\n      campos_invoice_base\n    }\n  }];\n};\n\nconst criarSucesso = (resumo, dados, tags_sucesso, alertas, info, campos_deal = {}, campos_invoice_base = {}) => {\n  return [{\n    json: {\n      _no: '6C',\n      _versao: '3.2',\n      _timestamp: new Date().toISOString(),\n      _tempo_ms: Date.now() - inicio,\n\n      ok: true,\n      erro: null,\n\n      tags_sucesso,\n      alertas,\n      info,\n\n      resumo,\n      dados,\n\n      CAMPOS_DEAL_IDS: CD,\n      CAMPOS_INVOICE_IDS: CI,\n      CAMPOS_EXTRAS: CAMPOS_EXTRAS,\n\n      campos_deal,\n      campos_invoice_base\n    }\n  }];\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// FUNÃ‡Ã•ES DE CÃLCULO\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst obterFaixa = (valorParcela) => {\n  for (const faixa of CONFIG.FAIXAS) {\n    if (valorParcela >= faixa.min) return faixa;\n  }\n  return CONFIG.FAIXAS[CONFIG.FAIXAS.length - 1];\n};\n\nconst podeQuitar = (valorParcela, saldoStart) => {\n  const clienteFicaCom = valorParcela - saldoStart;\n  const minimoCliente = valorParcela * CONFIG.MINIMO_CLIENTE;\n  return clienteFicaCom >= minimoCliente;\n};\n\nconst calcularPorFaixa = (valorParcela, saldoStart) => {\n  const faixa = obterFaixa(valorParcela);\n  // v3.3: Arredondar para baixo (sem centavos)\n  let valorStart = Math.floor(valorParcela * faixa.aliquota);\n\n  if (valorStart > saldoStart) valorStart = saldoStart;\n\n  const clienteFicaCom = valorParcela - valorStart;\n  const minimoCliente = tr(valorParcela * CONFIG.MINIMO_CLIENTE);\n\n  if (clienteFicaCom < minimoCliente) {\n    // v3.3: Arredondar para baixo\n    valorStart = Math.floor(valorParcela - minimoCliente);\n  }\n\n  // v3.3: Garantir inteiro no retorno\n  return { valorStart: Math.floor(valorStart), faixa: faixa.nome, aliquota: faixa.aliquota };\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// PROCESSAMENTO PRINCIPAL\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst tags_sucesso = [];\nconst alertas = [];\nconst info = [];\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// 1. VALIDAR INPUT\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst input = $json;\n\nconst campos_deal_6B = input?.campos_deal || {};\nconst campos_invoice_6B = input?.campos_invoice_base || {};\n\nconst contexto = {\n  nome: input?.resumo?.nome || input?.dados?.cliente?.nome,\n  cpf: input?.resumo?.cpf || input?.dados?.cliente?.cpf,\n  nb: input?.resumo?.nb || input?.dados?.beneficio?.nb,\n  deal_id: input?.resumo?.deal_id || input?.dados?.deal_id,\n  deal: input?.dados?.deal\n};\n\nif (!input) {\n  return criarErro('E_INPUT_NULO', { input_type: typeof input }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (input.ok === false) {\n  return criarErro('E_INPUT_OK_FALSE', {\n    erro_anterior: input.erro,\n    tag_anterior: input.erro?.tag,\n    codigo_anterior: input.erro?.codigo\n  }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (!input.resumo) {\n  return criarErro('E_SEM_RESUMO', { campos_presentes: Object.keys(input) }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (!input.dados) {\n  return criarErro('E_SEM_DADOS', { campos_presentes: Object.keys(input) }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (!input.dados.deal) {\n  return criarErro('E_SEM_DEAL', { dados_campos: Object.keys(input.dados) }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\ntags_sucesso.push('OK_INPUT_VALIDADO');\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// 2. EXTRAIR DADOS DO 6B\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst resumo6B = input.resumo;\nconst dados6B = input.dados;\n\nconst { nome, cpf, nb, deal_id, mr, aliquota_efetiva, total_120_dias, tem_13o, valor_13o } = resumo6B;\n\nif (!total_120_dias || total_120_dias === 0) {\n  return criarErro('E_TOTAL_120_ZERO', { total_120_dias, mr, aliquota_efetiva }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (total_120_dias < 0) {\n  return criarErro('E_TOTAL_120_NEGATIVO', { total_120_dias, mr }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (!mr || mr === 0) {\n  return criarErro('E_MR_ZERO', { mr, resumo_keys: Object.keys(resumo6B) }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\nif (aliquota_efetiva === undefined || aliquota_efetiva === null) {\n  alertas.push('ALERTA_ALIQUOTA_INSS_NAO_VEIO_6B');\n  info.push('INFO_USANDO_ALIQUOTA_DEFAULT_7.5');\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// 3. COLETAR E AGRUPAR PARCELAS POR DATA\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst creditos = dados6B.creditos || [];\nconst parcelasProjetadas = dados6B.parcelas_projetadas || [];\n\nconst qtdExtrato = creditos.length;\nconst qtdProjetadas = parcelasProjetadas.length;\n\ninfo.push(`INFO_PARCELAS_EXTRATO_${qtdExtrato}`);\ninfo.push(`INFO_PARCELAS_PROJETADAS_${qtdProjetadas}`);\n\nif (qtdExtrato === 0) {\n  alertas.push('ALERTA_EXTRATO_SEM_CREDITOS');\n  info.push('INFO_USANDO_APENAS_PROJECOES');\n}\n\nif (qtdExtrato === 0 && qtdProjetadas === 0) {\n  return criarErro('E_SEM_PARCELAS', {\n    creditos_length: qtdExtrato,\n    projetadas_length: qtdProjetadas\n  }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// TRY/CATCH PARA E_CALCULO_EXCEPTION\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\ntry {\n\n  // Agrupar por data de pagamento\n  const parcelasPorData = {};\n\n  creditos.forEach(cred => {\n    const dataPag = extrairData(cred.pagamento?.previsao) || extrairData(cred.pagamento?.data);\n    if (!dataPag) return;\n\n    if (!parcelasPorData[dataPag]) {\n      parcelasPorData[dataPag] = { data: dataPag, valor: 0, dias: 0, origem: [], tem_13o: false, valor_13o: 0, competencia: null };\n    }\n\n    // Base EXTRATO: valor lÃ­quido real do PDF\n    parcelasPorData[dataPag].valor += cred.valores?.liquido || 0;\n    parcelasPorData[dataPag].dias += cred.dias || 0;\n    parcelasPorData[dataPag].origem.push('EXTRATO');\n    if (cred.competencia) parcelasPorData[dataPag].competencia = cred.competencia;\n\n    if (cred.flags?.tem_13o && cred.valores?.decimo_terceiro > 0) {\n      parcelasPorData[dataPag].tem_13o = true;\n      parcelasPorData[dataPag].valor_13o += cred.valores.decimo_terceiro;\n    }\n  });\n\n  parcelasProjetadas.forEach(proj => {\n    const dataPag = extrairData(proj.data_pagamento_prevista);\n    if (!dataPag) return;\n\n    if (!parcelasPorData[dataPag]) {\n      parcelasPorData[dataPag] = { data: dataPag, valor: 0, dias: 0, origem: [], tem_13o: false, valor_13o: 0, competencia: null };\n    }\n\n    // Base PROJETADA: valor lÃ­quido projetado do 6B\n    parcelasPorData[dataPag].valor += proj.valor_liquido || 0;\n    parcelasPorData[dataPag].dias += proj.dias || 0;\n    parcelasPorData[dataPag].origem.push('PROJETADA');\n    if (proj.competencia) parcelasPorData[dataPag].competencia = proj.competencia;\n  });\n\n  const parcelasAgrupadas = Object.values(parcelasPorData)\n    .map(p => ({ ...p, valor: tr(p.valor) }))\n    .sort((a, b) => a.data.localeCompare(b.data));\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  // V3.2: CALCULAR BASE DE HONORÃRIOS (REAL + PROJETADA)\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  // ObservaÃ§Ã£o: p.valor jÃ¡ representa:\n  //   - EXTRATO: soma dos liquidos reais\n  //   - PROJETADA: soma dos valores projetados\n  // Aqui mantemos logs por origem para auditoria.\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n  let totalHonorariosBase = 0;\n\n  for (const p of parcelasAgrupadas) {\n    totalHonorariosBase += (p.valor || 0);\n\n    if (p.origem.includes('EXTRATO')) {\n      info.push(`INFO_PARCELA_EXTRATO_VALOR_REAL_${tr(p.valor)}`);\n    }\n    if (p.origem.includes('PROJETADA')) {\n      info.push(`INFO_PARCELA_PROJETADA_VALOR_TEORICO_${tr(p.valor)}`);\n    }\n  }\n\n  totalHonorariosBase = tr(totalHonorariosBase);\n  info.push(`INFO_TOTAL_BASE_HONORARIOS_${tr(totalHonorariosBase)}`);\n\n  // âœ… CorreÃ§Ã£o chave: definir honorariosStart\n  // v3.3: Arredondar honorÃ¡rios Start para baixo (sem centavos)\n  const honorariosStart = Math.floor(totalHonorariosBase * CONFIG.ALIQUOTA_HONORARIOS);\n  info.push(`INFO_HONORARIOS_START_${tr(honorariosStart)}`);\n\n  // (Opcional) auditoria real vs teÃ³rico (120 dias)\n  if (total_120_dias && total_120_dias > 0 && totalHonorariosBase !== total_120_dias) {\n    info.push(`INFO_DIFERENCA_REAL_VS_TEORICO_${tr(totalHonorariosBase - total_120_dias)}`);\n    if (totalHonorariosBase > total_120_dias) {\n      tags_sucesso.push('OK_USANDO_VALOR_REAL_EXTRATO');\n    }\n  }\n\n  if (parcelasAgrupadas.length === 0) {\n    return criarErro('E_SEM_PARCELAS', { motivo: 'Nenhuma parcela com data vÃ¡lida' }, contexto, campos_deal_6B, campos_invoice_6B);\n  }\n\n  tags_sucesso.push('OK_PARCELAS_AGRUPADAS');\n  info.push(`INFO_TOTAL_PARCELAS_${parcelasAgrupadas.length}`);\n\n  const diasTotais = parcelasAgrupadas.reduce((sum, p) => sum + p.dias, 0);\n  info.push(`INFO_DIAS_TOTAIS_${diasTotais}`);\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // 4. VALIDAR HONORÃRIOS START (jÃ¡ calculado acima na v3.2)\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  if (honorariosStart <= 0) {\n    return criarErro('E_HONORARIOS_ZERO', {\n      totalHonorariosBase,\n      aliquota: CONFIG.ALIQUOTA_HONORARIOS,\n      calculo: `${tr(totalHonorariosBase)} Ã— ${CONFIG.ALIQUOTA_HONORARIOS} = ${honorariosStart}`\n    }, contexto, campos_deal_6B, campos_invoice_6B);\n  }\n\n  tags_sucesso.push('OK_HONORARIOS_CALCULADOS');\n\n  const deal = dados6B.deal;\n\n  const saldoStartExistente = parseFloat(deal?.['UF_CRM_69442F27CCFB3']) || 0;\n\n  if (saldoStartExistente === 0) {\n    info.push('INFO_PRIMEIRO_PROCESSAMENTO');\n  } else {\n    alertas.push('ALERTA_REPROCESSAMENTO');\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // 4.1 LER DARF DO DEAL (para usar depois do cÃ¡lculo)\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  const necessitaDarfRaw = (deal?.[CD.necessita_darf] ?? '').toString().trim();\n  const startPagaDarf = necessitaDarfRaw === 'Sim! Start irÃ¡ pagar!';\n  const valorDarf = tr(parseValor(deal?.[CD.valor_darf]));\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // 5. SIMULAR PARCELAS (CÃLCULO NORMAL - SEM DARF)\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  let saldoStart = honorariosStart;\n  let parcelaQuitacao = null;\n  let diasAcumulados = 0;\n  let valorAcumulado = 0;\n\n  const parcelasCalculadas = [];\n  const faixasAplicadas = new Set();\n\n  for (let i = 0; i < parcelasAgrupadas.length; i++) {\n    const parcela = parcelasAgrupadas[i];\n    const numero = i + 1;\n    const valorParcela = parcela.valor;\n\n    if (!parcela.data) {\n      return criarErro('E_PARCELA_SEM_DATA', { parcela: numero, dados_parcela: parcela }, contexto, campos_deal_6B, campos_invoice_6B);\n    }\n\n    if (!valorParcela || valorParcela <= 0) {\n      return criarErro('E_PARCELA_SEM_VALOR', { parcela: numero, valor: valorParcela }, contexto, campos_deal_6B, campos_invoice_6B);\n    }\n\n    const diasRestantes = diasTotais - diasAcumulados - parcela.dias;\n    const valorRestante = tr(parcelasAgrupadas.slice(i + 1).reduce((sum, p) => sum + p.valor, 0));\n    const parcelasRestantes = parcelasAgrupadas.length - numero;\n\n    let valorStart = 0;\n    let aliquotaAplicada = null;\n    let aliquotaEfetivaParcela = 0;\n    let regraAplicada = '';\n\n    if (saldoStart <= 0) {\n      regraAplicada = 'QUITADO';\n      aliquotaEfetivaParcela = 0;\n    } else {\n      if (podeQuitar(valorParcela, saldoStart)) {\n        // v3.3: QuitaÃ§Ã£o tambÃ©m truncada\n        valorStart = Math.floor(saldoStart);\n        regraAplicada = 'QUITACAO';\n        aliquotaEfetivaParcela = tr(valorStart / valorParcela);\n        parcelaQuitacao = numero;\n        tags_sucesso.push(`OK_QUITACAO_P${numero <= 4 ? numero : '5_PLUS'}`);\n      } else {\n        const resultado = calcularPorFaixa(valorParcela, saldoStart);\n        valorStart = resultado.valorStart;\n        aliquotaAplicada = resultado.aliquota;\n        aliquotaEfetivaParcela = tr(valorStart / valorParcela);\n        regraAplicada = resultado.faixa;\n        faixasAplicadas.add(resultado.faixa);\n      }\n    }\n\n    const saldoAntes = saldoStart;\n    saldoStart = tr(saldoStart - valorStart);\n\n    // Valor cliente = parcela - honorÃ¡rios (SEM DARF ainda)\n    const valorCliente = tr(valorParcela - valorStart);\n    const percentualCliente = tr(valorCliente / valorParcela);\n\n    // Verificar regra 50% (sobre honorÃ¡rios apenas)\n    if (regraAplicada !== 'QUITADO' && percentualCliente < CONFIG.MINIMO_CLIENTE) {\n      alertas.push(`ALERTA_REGRA_50_VIOLADA_P${numero}`);\n    }\n\n    // Alertas por parcela\n    if (valorParcela < CONFIG.PARCELA_BAIXA_LIMITE) {\n      alertas.push(`ALERTA_PARCELA_BAIXA_P${numero}`);\n    }\n\n    if (percentualCliente > 0 && percentualCliente < CONFIG.MARGEM_APERTADA_LIMITE) {\n      alertas.push(`ALERTA_MARGEM_50_APERTADA_P${numero}`);\n    }\n\n    const hoje = new Date().toLocaleDateString('sv-SE', { timeZone: 'America/Sao_Paulo' });\n    if (parcela.data < hoje) {\n      alertas.push(`ALERTA_DATA_RETROATIVA_P${numero}`);\n    }\n\n    diasAcumulados += parcela.dias;\n    valorAcumulado += valorParcela;\n\n    parcelasCalculadas.push({\n      numero,\n      data_pagamento: parcela.data,\n      data_pagamento_formatada: formatarDataBR(parcela.data),\n      competencia: parcela.competencia,\n\n      valor_parcela: valorParcela,\n      valor_parcela_formatado: formatarMoeda(valorParcela),\n\n      // HonorÃ¡rios (sem DARF)\n      valor_start: valorStart,\n      valor_start_formatado: formatarMoeda(valorStart),\n\n      // DARF (serÃ¡ preenchido depois)\n      valor_darf_rateado: 0,\n      valor_darf_rateado_formatado: formatarMoeda(0),\n\n      // Total Start (honorÃ¡rios + DARF) - serÃ¡ atualizado depois\n      valor_start_total: valorStart,\n      valor_start_total_formatado: formatarMoeda(valorStart),\n\n      // Cliente (parcela - start_total) - serÃ¡ atualizado depois\n      valor_cliente: valorCliente,\n      valor_cliente_formatado: formatarMoeda(valorCliente),\n\n      aliquota_aplicada: aliquotaAplicada,\n      aliquota_efetiva: aliquotaEfetivaParcela,\n      aliquota_efetiva_formatada: formatarPercentual(aliquotaEfetivaParcela),\n\n      // Percentual cliente calculado sobre honorÃ¡rios (para regra 50%)\n      percentual_cliente: percentualCliente,\n      percentual_cliente_formatado: formatarPercentual(percentualCliente),\n\n      regra_aplicada: regraAplicada,\n\n      saldo_start_antes: saldoAntes,\n      saldo_start_antes_formatado: formatarMoeda(saldoAntes),\n      saldo_start_depois: saldoStart,\n      saldo_start_depois_formatado: formatarMoeda(saldoStart),\n\n      dias: parcela.dias,\n      dias_acumulados: diasAcumulados,\n      dias_restantes: diasRestantes,\n\n      valor_restante: valorRestante,\n      valor_restante_formatado: formatarMoeda(valorRestante),\n      parcelas_restantes: parcelasRestantes,\n\n      origem: parcela.origem.join('+'),\n      tem_13o: parcela.tem_13o,\n      valor_13o: parcela.valor_13o\n    });\n  }\n\n  // Tags das faixas\n  faixasAplicadas.forEach(faixa => tags_sucesso.push(`OK_${faixa}_APLICADA`));\n\n  // Verificar regra 50% geral (sobre honorÃ¡rios)\n  const regra50Respeitada = parcelasCalculadas.every(p =>\n    p.percentual_cliente >= CONFIG.MINIMO_CLIENTE || p.regra_aplicada === 'QUITADO'\n  );\n\n  if (regra50Respeitada) {\n    tags_sucesso.push('OK_REGRA_50_RESPEITADA');\n  } else {\n    alertas.push('ALERTA_REGRA_50_NAO_RESPEITADA_GERAL');\n  }\n\n  // 13Âº (mantido como era)\n  if (tem_13o && valor_13o > 0) {\n    tags_sucesso.push('OK_13O_INCLUIDO');\n  } else {\n    tags_sucesso.push('OK_13O_EXCLUIDO');\n  }\n\n  // Alertas finais\n  if (parcelasAgrupadas.length > CONFIG.MUITAS_PARCELAS_LIMITE) alertas.push('ALERTA_MUITAS_PARCELAS');\n  if (parcelaQuitacao === parcelasAgrupadas.length) alertas.push('ALERTA_QUITACAO_TARDIA');\n  if (saldoStart > 0 && saldoStart < 1) alertas.push('ALERTA_SALDO_RESIDUAL');\n\n  if (!deal?.['UF_CRM_69442F27CCFB3']) {\n    alertas.push('ALERTA_DEAL_SEM_CAMPOS_START');\n  }\n\n  tags_sucesso.push('OK_SIMULACAO_COMPLETA');\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // 5.1 ADICIONAR DARF NAS PARCELAS ONDE START RECEBE\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // REGRA: DARF Ã© adicionada ao valor_start (Start recebe mais)\n  //        e subtraÃ­da do valor_cliente (cliente paga o reembolso)\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  // Identificar parcelas onde Start recebe (valor_start > 0)\n  const parcelasComStart = parcelasCalculadas.filter(p => (p.valor_start || 0) > 0);\n  const qtdParcelasStart = parcelasComStart.length;\n\n  let darfTotal = 0;\n  let darfPorParcelaAprox = 0;\n\n  if (startPagaDarf) {\n    if (valorDarf > 0) {\n      darfTotal = valorDarf;\n      tags_sucesso.push('OK_DARF_EXISTE');\n      info.push(`INFO_DARF_TOTAL_${formatarMoeda(darfTotal)}`);\n      info.push(`INFO_DARF_PARCELAS_START_${qtdParcelasStart}`);\n\n      if (qtdParcelasStart > 0) {\n        tags_sucesso.push(`OK_DARF_PARCELAS_START_${qtdParcelasStart}`);\n\n        // Rateio por centavos para fechar exatamente\n        const totalCent = Math.round(darfTotal * 100);\n        const baseCent = Math.floor(totalCent / qtdParcelasStart);\n        let resto = totalCent - (baseCent * qtdParcelasStart);\n\n        for (const p of parcelasCalculadas) {\n          if ((p.valor_start || 0) <= 0) continue;\n\n          // Distribui centavos extras nas primeiras parcelas\n          const extraCent = baseCent + (resto > 0 ? 1 : 0);\n          if (resto > 0) resto--;\n\n          const darfRateado = tr(extraCent / 100);\n\n          // Atualiza a parcela\n          p.valor_darf_rateado = darfRateado;\n          p.valor_darf_rateado_formatado = formatarMoeda(darfRateado);\n\n          // Start recebe: honorÃ¡rios + DARF\n          p.valor_start_total = tr(p.valor_start + darfRateado);\n          p.valor_start_total_formatado = formatarMoeda(p.valor_start_total);\n\n          // Cliente fica: parcela - total Start\n          p.valor_cliente = tr(p.valor_parcela - p.valor_start_total);\n          p.valor_cliente_formatado = formatarMoeda(p.valor_cliente);\n        }\n\n        darfPorParcelaAprox = tr(darfTotal / qtdParcelasStart);\n        info.push(`INFO_DARF_POR_PARCELA_APROX_${formatarMoeda(darfPorParcelaAprox)}`);\n        alertas.push('ALERTA_DARF_START_PAGA');\n\n      } else {\n        // NÃ£o hÃ¡ parcelas com recebimento Start\n        alertas.push('ALERTA_DARF_SEM_PARCELAS_START');\n      }\n    } else {\n      // Marcado para Start pagar mas sem valor\n      alertas.push('ALERTA_DARF_START_PAGA_SEM_VALOR');\n    }\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // 6. MONTAR RETORNO\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  // Totais (honorÃ¡rios apenas, sem DARF)\n  const totalStartHonorarios = tr(parcelasCalculadas.reduce((sum, p) => sum + (p.valor_start || 0), 0));\n\n  // Totais com DARF\n  const totalStartComDarf = tr(parcelasCalculadas.reduce((sum, p) => sum + (p.valor_start_total || 0), 0));\n  const totalCliente = tr(parcelasCalculadas.reduce((sum, p) => sum + (p.valor_cliente || 0), 0));\n  const totalDarfRateado = tr(parcelasCalculadas.reduce((sum, p) => sum + (p.valor_darf_rateado || 0), 0));\n\n  const aliquotaINSSUsada = aliquota_efetiva || 7.5;\n  const valorLiquidoMensal = tr(mr - (mr * aliquotaINSSUsada / 100));\n  const valorDiario = tr(valorLiquidoMensal / 30);\n\n  const primeiraParcela = parcelasCalculadas[0];\n  const ultimaParcela = parcelasCalculadas[parcelasCalculadas.length - 1];\n\n  const resumoFinal = {\n    nome, cpf, nb, deal_id,\n    mr, mr_formatado: formatarMoeda(mr),\n    aliquota_inss: aliquotaINSSUsada,\n    aliquota_inss_formatada: `${aliquotaINSSUsada}%`,\n    total_120_dias, total_120_dias_formatado: formatarMoeda(total_120_dias),\n\n    aliquota_honorarios: CONFIG.ALIQUOTA_HONORARIOS,\n    aliquota_honorarios_formatada: formatarPercentual(CONFIG.ALIQUOTA_HONORARIOS),\n\n    honorarios_start: honorariosStart,\n    honorarios_start_formatado: formatarMoeda(honorariosStart),\n\n    total_parcelas: parcelasAgrupadas.length,\n    parcela_quitacao: parcelaQuitacao,\n\n    // HonorÃ¡rios (sem DARF)\n    total_start_honorarios: totalStartHonorarios,\n    total_start_honorarios_formatado: formatarMoeda(totalStartHonorarios),\n\n    // DARF\n    start_paga_darf: startPagaDarf,\n    valor_darf_original: darfTotal,\n    valor_darf_original_formatado: formatarMoeda(darfTotal),\n    total_darf_rateado: totalDarfRateado,\n    total_darf_rateado_formatado: formatarMoeda(totalDarfRateado),\n    qtd_parcelas_start_recebe: qtdParcelasStart,\n    valor_darf_por_parcela_aprox: darfPorParcelaAprox,\n    valor_darf_por_parcela_aprox_formatado: formatarMoeda(darfPorParcelaAprox),\n\n    // Total Start (honorÃ¡rios + DARF)\n    total_start: totalStartComDarf,\n    total_start_formatado: formatarMoeda(totalStartComDarf),\n\n    // Cliente (parcela - total Start)\n    total_cliente: totalCliente,\n    total_cliente_formatado: formatarMoeda(totalCliente),\n\n    saldo_start_final: saldoStart,\n    saldo_start_final_formatado: formatarMoeda(saldoStart),\n\n    dias_totais: diasTotais,\n\n    tem_13o, valor_13o, valor_13o_formatado: formatarMoeda(valor_13o || 0)\n  };\n\n  const dadosFinal = {\n    config: { aliquota_honorarios: CONFIG.ALIQUOTA_HONORARIOS, faixas: CONFIG.FAIXAS, minimo_cliente: CONFIG.MINIMO_CLIENTE },\n    parcelas: parcelasCalculadas,\n    deal_id, deal,\n    creditos_originais: creditos,\n    parcelas_projetadas_originais: parcelasProjetadas\n  };\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  // ENRIQUECER campos_deal E campos_invoice COM DADOS CALCULADOS\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n  const campos_deal_enriquecido = {\n    ...campos_deal_6B,\n\n    [CD.mr_cliente]: formatMoneyBitrix(mr),\n    [CD.valor_total_beneficio]: total_120_dias,\n\n    [CD.aliquota_mr]: aliquotaINSSUsada,\n    [CD.qtd_parcelas]: String(parcelasAgrupadas.length)\n  };\n\n  const campos_invoice_enriquecido = {\n    ...campos_invoice_6B,\n\n    [CI.mr_cliente]: formatMoneyBitrix(mr),\n    [CI.valor_diario]: valorDiario,\n    [CI.valor_liquido_mensal]: formatMoneyBitrix(valorLiquidoMensal),\n    [CI.valor_total_beneficio]: total_120_dias,\n\n    [CI.aliquota_mr]: aliquotaINSSUsada,\n    [CI.aliquota_start]: tr(CONFIG.ALIQUOTA_HONORARIOS * 100),\n\n    // HonorÃ¡rios + DARF = total que Start recebe\n    [CI.valor_total_start]: formatMoneyBitrix(totalStartComDarf),\n    [CI.saldo_restante_start]: formatMoneyBitrix(saldoStart),\n\n    // Cliente = benefÃ­cio - total Start (SEM DARF separado)\n    [CI.valor_restante_inss]: formatMoneyBitrix(totalCliente),\n\n    [CI.regra_aplicada]: primeiraParcela.regra_aplicada,\n    [CI.qtd_parcelas]: String(parcelasAgrupadas.length),\n\n    // DARF na invoice (informativo)\n    [CI.necessita_darf]: startPagaDarf ? 'Sim! Start irÃ¡ pagar!' : (necessitaDarfRaw || null),\n    [CI.valor_darf]: (darfTotal > 0 ? formatMoneyBitrix(darfTotal) : null)\n  };\n\n  if (!campos_invoice_6B[CI.competencia_final] && ultimaParcela.competencia) {\n    campos_invoice_enriquecido[CI.competencia_final] = ultimaParcela.competencia;\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // DEBUG\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  info.push('INFO_CAMPOS_DEAL_ENRIQUECIDOS');\n  info.push(`INFO_CAMPOS_DEAL_6B_RECEBIDOS_${Object.keys(campos_deal_6B).length}`);\n  info.push(`INFO_CAMPOS_DEAL_TOTAL_${Object.keys(campos_deal_enriquecido).length}`);\n  info.push(`INFO_CAMPOS_INVOICE_6B_RECEBIDOS_${Object.keys(campos_invoice_6B).length}`);\n  info.push(`INFO_CAMPOS_INVOICE_TOTAL_${Object.keys(campos_invoice_enriquecido).length}`);\n\n  if (campos_deal_6B[CD.dip]) {\n    info.push('INFO_DIP_PRESERVADO_6B');\n  } else {\n    alertas.push('ALERTA_DIP_NAO_VEIO_6B');\n  }\n\n  if (campos_deal_6B[CD.competencia_final]) {\n    info.push('INFO_COMPETENCIA_FINAL_PRESERVADA_6B');\n  }\n\n  console.log(JSON.stringify({\n    no: '6C',\n    versao: '3.2',\n    campos_deal_in: Object.keys(campos_deal_6B).length,\n    campos_deal_out: Object.keys(campos_deal_enriquecido).length,\n    campos_invoice_in: Object.keys(campos_invoice_6B).length,\n    campos_invoice_out: Object.keys(campos_invoice_enriquecido).length,\n    honorarios: honorariosStart,\n    darf_total: darfTotal,\n    darf_parcelas: qtdParcelasStart,\n    total_start_com_darf: totalStartComDarf,\n    total_cliente: totalCliente,\n    saldo_final: saldoStart\n  }));\n\n  return criarSucesso(resumoFinal, dadosFinal, tags_sucesso, alertas, info, campos_deal_enriquecido, campos_invoice_enriquecido);\n\n} catch (excecao) {\n  return criarErro('E_CALCULO_EXCEPTION', {\n    mensagem: excecao.message,\n    stack: excecao.stack?.substring(0, 500),\n    linha: excecao.lineNumber || 'N/A'\n  }, contexto, campos_deal_6B, campos_invoice_6B);\n}\n"
  },
  "type": "n8n-nodes-base.code",
  "typeVersion": 2,
  "position": [
    6176,
    25712
  ],
  "id": "2a21d8b1-29ed-4094-9035-80ee88a42a15",
  "name": "6C. Calculo Start"
}