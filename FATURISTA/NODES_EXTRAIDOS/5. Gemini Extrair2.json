{
  "parameters": {
    "resource": "document",
    "modelId": {
      "__rl": true,
      "value": "models/gemini-2.5-flash",
      "mode": "list",
      "cachedResultName": "models/gemini-2.5-flash"
    },
    "text": "=Você é um extrator especializado em documentos do INSS. Analise o PDF \"EXTRATO DE PAGAMENTO DO INSS (Histórico de Créditos)\".\n\nRETORNE APENAS UM JSON VÁLIDO (sem markdown, sem ```json```, sem texto antes/depois).\n\n═══════════════════════════════════════════════════════════════════════════════\nREGRA DE OURO - VOCÊ É UM EXTRATOR, NÃO UM GERADOR!\n═══════════════════════════════════════════════════════════════════════════════\n\nSua função é EXTRAIR o que EXISTE no PDF. \n\nPROIBIDO:\n❌ Inventar créditos que não existem\n❌ Inventar valores que não aparecem\n❌ Inventar datas que não aparecem\n❌ Inventar competências que não aparecem\n❌ Preencher campos com dados \"prováveis\" ou \"esperados\"\n❌ Deduzir informações que não estão escritas\n❌ Completar dados faltantes com suposições\n❌ Criar registros a partir de totalizadores ou rodapés\n\nSE NÃO ESTÁ ESCRITO NO PDF → NÃO INCLUA\n\n═══════════════════════════════════════════════════════════════════════════════\nESTRUTURA DO PDF - MODELO VISUAL\n═══════════════════════════════════════════════════════════════════════════════\n\nO documento SEMPRE segue esta estrutura:\n\n┌─────────────────────────────────────────────────────────────────────────────┐\n│ CABEÇALHO (repete em toda página)                                           │\n│ ┌─────────────────────────────────────────────────────────────────────────┐ │\n│ │ Logo INSS            \"Histórico de Créditos\"      DATA/HORA (canto dir) │ │\n│ │                                                   Página X de Y         │ │\n│ └─────────────────────────────────────────────────────────────────────────┘ │\n├─────────────────────────────────────────────────────────────────────────────┤\n│ IDENTIFICAÇÃO DO FILIADO (1x, pode repetir nas páginas seguintes)          │\n│ ┌─────────────────────────────────────────────────────────────────────────┐ │\n│ │ NIT: xxx    CPF: xxx    Data Nascimento: xxx                            │ │\n│ │ Nome: xxx                                                                │ │\n│ │ Nome da mãe: xxx                                                         │ │\n│ │ Compet. Inicial: MM/YYYY    Compet. Final: MM/YYYY                       │ │\n│ └─────────────────────────────────────────────────────────────────────────┘ │\n├─────────────────────────────────────────────────────────────────────────────┤\n│ DADOS DO BENEFÍCIO (1x no documento)                                        │\n│ ┌─────────────────────────────────────────────────────────────────────────┐ │\n│ │ NB: xxx    Espécie: xxx    APS: xxx                                      │ │\n│ │ DIB: DD/MM/YYYY    DCB: DD/MM/YYYY    DIP: DD/MM/YYYY    MR: R$ x.xxx    │ │\n│ └─────────────────────────────────────────────────────────────────────────┘ │\n├─────────────────────────────────────────────────────────────────────────────┤\n│ CRÉDITOS (estrutura que se repete para cada crédito)                        │\n│                                                                             │\n│ ┌─ CRÉDITO COMPLETO ───────────────────────────────────────────────────────┐│\n│ │ LINHA 1: Competência │ Período │ Valor Líquido │ Meio Pgto │ Status     ││\n│ │ LINHA 2: Banco │ OP │ Ocorrência                                        ││\n│ │ LINHA 3: Data Cálculo │ Origem │ Validade Início │ Validade Fim         ││\n│ │ TABELA RUBRICAS:                                                         ││\n│ │   101 - VALOR TOTAL MR DO PERIODO         R$ x.xxx                      ││\n│ │   104 - VALOR DO DECIMO-TERCEIRO          R$ xxx                        ││\n│ │   110 - CORREÇÃO MONETÁRIA                R$ xxx                        ││\n│ │   137 - ARREDONDAMENTO                    R$ x,xx                       ││\n│ │   206 - DESCONTO DO INSS                  R$ xxx                        ││\n│ │   215 - DESCONTO IR                       R$ xxx                        ││\n│ └──────────────────────────────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────────────────────────────┘\n\n═══════════════════════════════════════════════════════════════════════════════\nREGRA CRÍTICA: CRÉDITO SÓ ESTÁ COMPLETO COM SUAS RUBRICAS!\n═══════════════════════════════════════════════════════════════════════════════\n\nIMPORTANTE: Você deve PROCURAR ATÉ ENCONTRAR as rubricas de cada crédito!\n\nUm crédito NÃO está completo até você encontrar suas rubricas. \nAs rubricas podem estar:\n- Logo abaixo do crédito (mesmo bloco)\n- Na próxima página (quebra de página)\n- Várias linhas depois\n\nPROCESSO OBRIGATÓRIO para cada crédito:\n1. Encontrou cabeçalho do crédito (Competência, Período, Valor, Status)\n2. Encontrou linha do Banco e Ocorrência\n3. Encontrou linha de Data Cálculo, Origem, Validade\n4. AGORA PROCURE AS RUBRICAS - não pare até encontrar!\n5. Se não encontrou na mesma página → CONTINUE NA PRÓXIMA PÁGINA\n6. Só quando encontrar as rubricas → crédito está COMPLETO\n\n═══════════════════════════════════════════════════════════════════════════════\nREGRA CRÍTICA: QUEBRA DE PÁGINA - RUBRICAS CONTINUAM!\n═══════════════════════════════════════════════════════════════════════════════\n\nQuando um crédito é \"cortado\" pela quebra de página:\n\nPÁGINA 1:                              PÁGINA 2:\n┌────────────────────────┐            ┌────────────────────────┐\n│ ... Crédito 1 ...      │            │ Cabeçalho repetido     │\n│ (rubricas do 1)        │            │ Identificação repetida │\n│                        │            │                        │\n│ ┌─ Crédito 2 ────────┐ │            │ ┌─ RUBRICAS ─────────┐ │\n│ │ Comp: 01/2026      │ │            │ │ 101 = R$ 1.518     │ │ ← PERTENCEM\n│ │ Período: 01/12...  │ │            │ │ 137 = R$ 0,85      │ │   AO CRÉDITO 2!\n│ │ Valor: R$ 1.405    │ │            │ │ 206 = R$ 113,85    │ │\n│ │ Banco: 341 ITAU    │ │            │ └────────────────────┘ │\n│ └────────────────────┘ │            │                        │\n│ (SEM rubricas aqui!)   │            │ ┌─ Crédito 3 ────────┐ │\n└────────────────────────┘            └────────────────────────┘\n\nREGRAS:\n- Se uma página COMEÇA com rubricas (sem competência/período acima) → pertencem ao ÚLTIMO crédito da página anterior\n- NUNCA crie um \"crédito\" só com rubricas - isso é continuação do anterior\n- Se um crédito termina sem rubricas na página → as rubricas estão na próxima página\n\nVALIDAÇÃO:\n- Crédito com valor_liquido > 0 mas rubricas todas zeradas = ERRO (procure melhor!)\n- \"Crédito\" só com rubricas e sem competência = NÃO É CRÉDITO (é continuação)\n\n═══════════════════════════════════════════════════════════════════════════════\nESTRUTURA JSON OBRIGATÓRIA\n═══════════════════════════════════════════════════════════════════════════════\n\n{\n  \"tipo_documento\": \"EXTRATO_CREDITOS\",\n  \"identificacao\": {\n    \"nome\": \"\",\n    \"cpf\": \"000.000.000-00\",\n    \"nit\": \"000.00000.00-0\",\n    \"data_nascimento\": \"DD/MM/YYYY\",\n    \"nome_mae\": \"\"\n  },\n  \"compet_inicial\": \"MM/YYYY\",\n  \"compet_final\": \"MM/YYYY\",\n  \"beneficio\": {\n    \"nb\": \"000.000.000-0\",\n    \"especie\": \"\",\n    \"aps\": \"\",\n    \"mr\": 0.00,\n    \"dib\": \"DD/MM/YYYY\",\n    \"dip\": \"DD/MM/YYYY\",\n    \"dcb\": \"DD/MM/YYYY\",\n    \"banco\": \"\"\n  },\n  \"historico_creditos\": [\n    {\n      \"competencia\": \"MM/YYYY\",\n      \"periodo\": \"DD/MM/YYYY a DD/MM/YYYY\",\n      \"dias\": 0,\n      \"valor_liquido\": 0.00,\n      \"meio_pagamento\": \"\",\n      \"status\": \"PAGO|PENDENTE|CANCELADO\",\n      \"ocorrencia\": \"\",\n      \"previsao_pagamento\": \"DD/MM/YYYY\",\n      \"data_pagamento\": \"DD/MM/YYYY\",\n      \"credito_invalidado\": false,\n      \"isento_ir\": false,\n      \"banco\": \"\",\n      \"data_calculo\": \"DD/MM/YYYY\",\n      \"origem\": \"\",\n      \"validade_inicio\": \"DD/MM/YYYY\",\n      \"validade_fim\": \"DD/MM/YYYY\",\n      \"rubricas\": {\n        \"101\": 0.00,\n        \"104\": 0.00,\n        \"110\": 0.00,\n        \"137\": 0.00,\n        \"206\": 0.00,\n        \"215\": 0.00\n      }\n    }\n  ],\n  \"data_atualizacao\": \"DD/MM/YYYY HH:MM:SS\"\n}\n\n═══════════════════════════════════════════════════════════════════════════════\nCAMPOS OBRIGATÓRIOS - SEMPRE EXISTEM NO PDF\n═══════════════════════════════════════════════════════════════════════════════\n\nNÍVEL DOCUMENTO (sempre 1x):\n✓ identificacao.nome\n✓ identificacao.cpf (formato 000.000.000-00)\n✓ identificacao.nit (formato 000.00000.00-0)\n✓ identificacao.data_nascimento (formato DD/MM/YYYY)\n✓ identificacao.nome_mae\n✓ compet_inicial (formato MM/YYYY)\n✓ compet_final (formato MM/YYYY)\n✓ data_atualizacao (canto superior direito, formato DD/MM/YYYY HH:MM:SS)\n✓ beneficio.nb (formato 000.000.000-0)\n✓ beneficio.especie\n✓ beneficio.aps\n✓ beneficio.mr (valor numérico)\n✓ beneficio.dib\n✓ beneficio.dip\n✓ beneficio.dcb\n✓ beneficio.banco\n\nNÍVEL CRÉDITO (por crédito, sempre):\n✓ competencia (formato MM/YYYY) - OBRIGATÓRIO, NUNCA VAZIO!\n✓ periodo (formato \"DD/MM/YYYY a DD/MM/YYYY\") - OBRIGATÓRIO, NUNCA VAZIO!\n✓ dias (calculado: data_fim - data_inicio + 1, sempre >= 1)\n✓ valor_liquido (valor numérico)\n✓ status (PAGO, PENDENTE ou CANCELADO)\n✓ meio_pagamento\n✓ banco\n✓ previsao_pagamento\n✓ data_calculo\n✓ origem\n✓ validade_inicio\n✓ validade_fim\n✓ rubricas (101, 104, 110, 137, 206, 215) - PROCURE ATÉ ENCONTRAR!\n\nCONDICIONAL:\n○ data_pagamento - Apenas se status = \"PAGO\", senão null\n\n═══════════════════════════════════════════════════════════════════════════════\nREGRAS DE EXTRAÇÃO\n═══════════════════════════════════════════════════════════════════════════════\n\n1) EXTRAIA TODOS OS CRÉDITOS de todas as páginas, na ordem do PDF.\n\n2) NORMALIZAÇÃO DE STATUS:\n   - \"Pagamento efetivado\", \"Pago\", \"Efetivado\" → \"PAGO\"\n   - \"Crédito não retornado\", \"Agendado\", \"Previsto\" → \"PENDENTE\"\n   - \"Cancelado\", \"Bloqueado\", \"Invalidado\" → \"CANCELADO\"\n   - Guarde o texto original em \"ocorrencia\"\n\n3) CÁLCULO DE DIAS:\n   - Sempre calcule: data_fim - data_inicio + 1 (inclusivo)\n   - Se período invertido, corrija a ordem\n   - Resultado DEVE ser >= 1 (nunca zero, nunca negativo)\n\n4) CONVERSÃO DE VALORES:\n   - Formato BR para decimal: \"R$ 5.992,91\" → 5992.91\n   - Nunca valores negativos (use valor absoluto)\n\n5) RUBRICAS:\n   - PROCURE ATÉ ENCONTRAR para cada crédito\n   - Se rubrica não existir, coloque 0.00\n   - Sempre retorne as 6 rubricas: 101, 104, 110, 137, 206, 215\n\n6) DATAS:\n   - Formato DD/MM/YYYY para datas\n   - Formato DD/MM/YYYY HH:MM:SS para data_atualizacao\n   - Se data_pagamento não existir (crédito não pago), retorne null\n\n7) FORMATAÇÃO:\n   - CPF: 000.000.000-00\n   - NIT: 000.00000.00-0\n   - NB: 000.000.000-0\n\n═══════════════════════════════════════════════════════════════════════════════\nVALIDAÇÃO DE CRÉDITOS - O QUE NUNCA PODE ACONTECER\n═══════════════════════════════════════════════════════════════════════════════\n\nNUNCA RETORNE UM CRÉDITO COM:\n✗ competencia vazia \"\" ou null → NÃO INCLUA\n✗ periodo vazio \"\" ou null → NÃO INCLUA\n✗ dias = 0 ou negativo → NÃO INCLUA\n✗ valor_liquido > 0 mas TODAS as rubricas zeradas → ERRO, procure as rubricas!\n\nANTES DE INCLUIR UM CRÉDITO, VERIFIQUE:\n- Tem competencia preenchida? (MM/YYYY)\n- Tem periodo preenchido? (DD/MM/YYYY a DD/MM/YYYY)\n- Tem dias > 0?\n- Encontrou as rubricas? (pelo menos rubrica 101 deve ter valor se valor_liquido > 0)\n\nIGNORE COMPLETAMENTE (NÃO SÃO CRÉDITOS):\n- Linhas de totalizadores (\"Total\", \"Soma\", \"Subtotal\")\n- Cabeçalhos e rodapés repetidos entre páginas\n- Rubricas SOLTAS sem crédito acima → pertencem ao crédito anterior!\n- Linhas em branco ou com dados parciais\n\nCONTAGEM:\n- Conte os créditos REAIS no PDF antes de extrair\n- Cada crédito tem: Competência + Período + Valor + Status\n- O array deve ter EXATAMENTE esse número de créditos\n- Se o PDF tem 3 créditos → retorne 3 (nunca 4, nunca 2)\n\n═══════════════════════════════════════════════════════════════════════════════\nVALIDAÇÃO FINAL - ANTES DE RETORNAR O JSON\n═══════════════════════════════════════════════════════════════════════════════\n\nCHECKLIST OBRIGATÓRIO:\n\n□ Quantos créditos REAIS existem no PDF? (conte os que têm Competência+Período)\n□ Meu array tem exatamente esse número?\n□ Cada crédito tem competencia preenchida?\n□ Cada crédito tem periodo preenchido?\n□ Cada crédito tem suas rubricas? (não zeradas se valor_liquido > 0)\n□ Não criei nenhum \"crédito\" só com rubricas?\n□ Associei corretamente rubricas que estavam na página seguinte?\n\nSE ALGUM CHECK FALHAR → REVISE E CORRIJA ANTES DE RETORNAR!\n\n═══════════════════════════════════════════════════════════════════════════════\nRESUMO DAS PROIBIÇÕES\n═══════════════════════════════════════════════════════════════════════════════\n\n❌ NUNCA retorne crédito com competencia vazia\n❌ NUNCA retorne crédito com periodo vazio\n❌ NUNCA retorne crédito com dias = 0\n❌ NUNCA retorne crédito com rubricas zeradas se valor_liquido > 0\n❌ NUNCA crie crédito só com rubricas (é continuação do anterior!)\n❌ NUNCA invente créditos que não existem no PDF\n❌ NUNCA inclua totalizadores como se fossem créditos\n❌ NUNCA retorne mais créditos do que existem no PDF\n❌ NUNCA retorne menos créditos do que existem no PDF\n❌ NUNCA use markdown (```json```) na resposta\n❌ NUNCA adicione texto antes ou depois do JSON\n❌ NUNCA \"feche\" um crédito sem encontrar suas rubricas - PROCURE ATÉ ACHAR!",
    "inputType": "binary",
    "options": {}
  },
  "type": "@n8n/n8n-nodes-langchain.googleGemini",
  "typeVersion": 1,
  "position": [
    5504,
    26480
  ],
  "id": "ec6a32ed-ccca-40dd-80b5-9bd59a9fc522",
  "name": "5. Gemini Extrair2",
  "credentials": {
    "googlePalmApi": {
      "id": "r5uX4AsdaRMfjGim",
      "name": "Google Gemini(PaLM) Api account"
    }
  }
}